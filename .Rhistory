hot_counties$ARS <- counties$ARS
library(classInt)
# classify the data - if you change the data to another country
# this step definitely needs some fine-tuning
hot_classes <- classIntervals(hot_counties_long$n_days,
n=8,
style="fixed",
fixedBreaks=c(0, 1, 5, 10, 15, 20, 25, 30, 100))
hot_counties_long$classes <- cut(hot_counties_long$n_days, hot_classes$brks)
hot_counties_long <- hot_counties %>%
pivot_longer(!ID, names_to = "Year", values_to = "n_days")
# make our data tidy and pivot to long
names(hot_counties) <- c("ARS", years)
hot_counties$ARS <- counties$ARS
hot_counties_long <- hot_counties %>%
pivot_longer(!ID, names_to = "Year", values_to = "n_days")
hot_counties_long <- hot_counties %>%
pivot_longer(!ARS, names_to = "Year", values_to = "n_days")
# classify the data - if you change the data to another country
# this step definitely needs some fine-tuning
hot_classes <- classIntervals(hot_counties_long$n_days,
n=8,
style="fixed",
fixedBreaks=c(0, 1, 5, 10, 15, 20, 25, 30, 100))
hot_counties_long$classes <- cut(hot_counties_long$n_days, hot_classes$brks)
landkreis_long <- left_join(hot_counties_long, counties, by = c("ID" = "ARS"))
# read in counties
# source of shapefile: https://gdz.bkg.bund.de/index.php/default/digitale-geodaten/verwaltungsgebiete/verwaltungsgebiete-1-2-500-000-stand-01-01-vg2500.html
counties <- st_read("vg2500/vg2500_krs.shp")
counties_vect <- vect(counties)
crs(counties_vect) <- dwd_crs
counties_vect <- terra::project(counties_vect, dwd_crs)
library(tidyverse)
library(glue)
library(terra)
library(sf)
library(scico)
library(hrbrthemes)
library(classInt)
# create folder to store data in project
dir.create("data")
# we have data for the following years:
years <- 1951L:2021L
# ... and start download it:
walk(years, function(year){
download.file(
glue("https://opendata.dwd.de/climate_environment/CDC/grids_germany/annual/hot_days/grids_germany_annual_hot_days_{year}_17.asc.gz"),
destfile = glue("data/grids_germany_annual_hot_days_{year}.asc.gz")
)
R.utils::gunzip(glue("data/grids_germany_annual_hot_days_{year}.asc.gz"), remove=TRUE)
})
# list all raster
hot_raster <- list.files(path = "data/", full.names = TRUE)
# and read them via terra:
hot_raster <- rast(hot_raster)
names(hot_raster) <- years
# read in counties
# source of shapefile: https://gdz.bkg.bund.de/index.php/default/digitale-geodaten/verwaltungsgebiete/verwaltungsgebiete-1-2-500-000-stand-01-01-vg2500.html
counties <- st_read("vg2500/vg2500_krs.shp")
counties_vect <- vect(counties)
# reproject to bring the data into the same space
dwd_crs <- "epsg:31467"
crs(hot_raster) <- dwd_crs
hot_raster <- terra::project(hot_raster, dwd_crs)
crs(counties_vect) <- dwd_crs
counties_vect <- terra::project(counties_vect, dwd_crs)
# extract raster values for each into the county polygon
hot_counties <- terra::extract(hot_raster,
counties_vect,
mean,
na.rm=TRUE)
# make our data tidy and pivot to long
names(hot_counties) <- c("ARS", years)
hot_counties$ARS <- counties_vect$ARS
hot_counties_long <- hot_counties %>%
pivot_longer(!ARS, names_to = "Year", values_to = "n_days")
# classify the data - if you change the data to another country
# this step definitely needs some fine-tuning
hot_classes <- classIntervals(hot_counties_long$n_days,
n=8,
style="fixed",
fixedBreaks=c(0, 1, 5, 10, 15, 20, 25, 30, 100))
hot_counties_long$classes <- cut(hot_counties_long$n_days, hot_classes$brks)
landkreis_long <- left_join(hot_counties_long, counties, by = c("ID" = "ARS"))
# and finally,
landkreis_long <- left_join(hot_counties_long, counties, by = c("ID" = "ARS"))
# and finally,
landkreis_long <- left_join(hot_counties_long, counties, by = c("ARS"))
landkreis_long %>%
st_as_sf() %>%
#filter(Year == "grids_germany_annual_hot_days_1953") %>%
ggplot() +
geom_sf(aes(fill = classes),
size = 0.01) +
scale_fill_manual(values = hot_colors,
na.value = "#f9f9f9") +
facet_wrap(Year ~ .) +
guides(fill = "none") +
theme_void()
landkreis_long %>%
st_as_sf() %>%
#filter(Year == "grids_germany_annual_hot_days_1953") %>%
ggplot() +
geom_sf(aes(fill = classes),
size = 0.01) +
scale_fill_viridis_d() +
facet_wrap(Year ~ .) +
guides(fill = "none") +
theme_void()
landkreis_long %>%
st_as_sf() %>%
#filter(Year == "grids_germany_annual_hot_days_1953") %>%
ggplot() +
geom_sf(aes(fill = classes),
size = 0.01) +
scale_fill_viridis_d(option = "H") +
facet_wrap(Year ~ .) +
guides(fill = "none") +
theme_void()
landkreis_long %>%
st_as_sf() %>%
#filter(Year == "grids_germany_annual_hot_days_1953") %>%
ggplot() +
geom_sf(aes(fill = classes),
size = 0.01) +
scale_fill_viridis_d(option = "K") +
facet_wrap(Year ~ .) +
guides(fill = "none") +
theme_void()
landkreis_long %>%
st_as_sf() %>%
#filter(Year == "grids_germany_annual_hot_days_1953") %>%
ggplot() +
geom_sf(aes(fill = classes),
size = 0.01) +
scale_fill_viridis_d(option = "F") +
facet_wrap(Year ~ .) +
guides(fill = "none") +
theme_void()
landkreis_long %>%
st_as_sf() %>%
#filter(Year == "grids_germany_annual_hot_days_1953") %>%
ggplot() +
geom_sf(aes(fill = classes),
size = 0.01) +
scale_fill_viridis_d(option = "F",
n = 6,
direction = -1,
begin = .17,
end = .97) +
facet_wrap(Year ~ .) +
guides(fill = "none") +
theme_void()
landkreis_long %>%
st_as_sf() %>%
#filter(Year == "grids_germany_annual_hot_days_1953") %>%
ggplot() +
geom_sf(aes(fill = classes),
size = 0.01) +
scale_fill_viridis_d(option = "F",
n = 8,
direction = -1,
begin = .17,
end = .97) +
facet_wrap(Year ~ .) +
guides(fill = "none") +
theme_void()
landkreis_long %>%
st_as_sf() %>%
#filter(Year == "grids_germany_annual_hot_days_1953") %>%
ggplot() +
geom_sf(aes(fill = classes),
size = 0.01) +
scale_fill_viridis_d(option = "F",
#n = 8,
direction = -1,
begin = .17,
end = .97) +
facet_wrap(Year ~ .) +
guides(fill = "none") +
theme_void()
landkreis_long %>%
st_as_sf() %>%
#filter(Year == "grids_germany_annual_hot_days_1953") %>%
ggplot() +
geom_sf(aes(fill = classes),
size = 0.01) +
scale_fill_viridis_d(option = "F",
#n = 8,
direction = -1,
begin = .17,
end = .97) +
facet_wrap(Year ~ .) +
theme(legend.position="bottom") +
theme_void()
landkreis_long %>%
st_as_sf() %>%
ggplot() +
geom_sf(aes(fill = classes),
size = 0.01) +
scale_fill_viridis_d(option = "F",
#n = 8,
direction = -1,
begin = .17,
end = .97) +
facet_wrap(Year ~ .) +
guides(fill = guide_colorbar(barheight = unit(3, units = "mm"),
barwidth = unit(90, units = "mm"),
direction = "horizontal",
ticks.colour = "white",
title.position = "top",
title.hjust = 0.5)) +
theme(legend.position="bottom") +
theme_void()
landkreis_long %>%
st_as_sf() %>%
ggplot() +
geom_sf(aes(fill = classes),
size = 0.01) +
scale_fill_viridis_d(option = "F",
#n = 8,
direction = -1,
begin = .17,
end = .97) +
facet_wrap(Year ~ .) +
guides(fill = guide_legend(barheight = unit(3, units = "mm"),
barwidth = unit(90, units = "mm"),
direction = "horizontal",
ticks.colour = "white",
title.position = "top",
title.hjust = 0.5)) +
theme(legend.position="bottom") +
theme_void()
landkreis_long %>%
st_as_sf() %>%
ggplot() +
geom_sf(aes(fill = classes),
size = 0.01) +
scale_fill_viridis_d(option = "F",
#n = 8,
direction = -1,
begin = .17,
end = .97) +
facet_wrap(Year ~ .) +
guides(fill = guide_legend(barheight = unit(3, units = "mm"),
barwidth = unit(90, units = "mm"),
direction = "horizontal",
ticks.colour = "white",
title.position = "top",
title.hjust = 0.5)) +
theme(legend.direction="horizontal",legend.position="top", legend.box = "vertical")+
theme_void()
# guides(fill = guide_legend(barheight = unit(3, units = "mm"),
#                              barwidth = unit(90, units = "mm"),
#                              direction = "horizontal",
#                              ticks.colour = "white",
#                              title.position = "top",
#                              title.hjust = 0.5)) +
landkreis_long %>%
st_as_sf() %>%
ggplot() +
geom_sf(aes(fill = classes),
size = 0.01) +
scale_fill_viridis_d(option = "F",
#n = 8,
direction = -1,
begin = .17,
end = .97) +
facet_wrap(Year ~ .) +
# guides(fill = guide_legend(barheight = unit(3, units = "mm"),
#                              barwidth = unit(90, units = "mm"),
#                              direction = "horizontal",
#                              ticks.colour = "white",
#                              title.position = "top",
#                              title.hjust = 0.5)) +
theme(legend.direction="horizontal",legend.position="top", legend.box = "vertical")+
theme_void()
landkreis_long %>%
st_as_sf() %>%
ggplot() +
geom_sf(aes(fill = classes),
size = 0.01) +
scale_fill_viridis_d(option = "F",
#n = 8,
direction = -1,
begin = .17,
end = .97) +
facet_wrap(Year ~ .) +
# guides(fill = guide_legend(barheight = unit(3, units = "mm"),
#                              barwidth = unit(90, units = "mm"),
#                              direction = "horizontal",
#                              ticks.colour = "white",
#                              title.position = "top",
#                              title.hjust = 0.5)) +
theme(legend.direction="vertical",legend.position="top", legend.box = "vertical")+
theme_void()
landkreis_long %>%
st_as_sf() %>%
ggplot() +
geom_sf(aes(fill = classes),
size = 0.01) +
scale_fill_viridis_d(option = "F",
#n = 8,
direction = -1,
begin = .17,
end = .97) +
facet_wrap(Year ~ .) +
guides(fill = guide_legend(barheight = unit(3, units = "mm"),
barwidth = unit(90, units = "mm"),
direction = "horizontal",
ticks.colour = "white",
title.position = "bottom",
title.hjust = 0.5)) +
theme(legend.direction="horizontal",legend.position="top", legend.box = "vertical")+
theme_void()
landkreis_long %>%
st_as_sf() %>%
ggplot() +
geom_sf(aes(fill = classes),
size = 0.01) +
scale_fill_viridis_d(option = "F",
#n = 8,
direction = -1,
begin = .17,
end = .97) +
facet_wrap(Year ~ .) +
guides(fill = guide_legend(barheight = unit(3, units = "mm"),
barwidth = unit(90, units = "mm"),
direction = "horizontal",
ticks.colour = "white",
title.position = "bottom",
title.hjust = 0.5)) +
theme(legend.direction="horizontal",legend.position=c(0.5, 0.01), legend.box = "vertical")+
theme_void()
# guides(fill = guide_legend(barheight = unit(3, units = "mm"),
#                              barwidth = unit(90, units = "mm"),
#                              direction = "horizontal",
#                              ticks.colour = "white",
#                              title.position = "bottom",
#                              title.hjust = 0.5)) +
landkreis_long %>%
st_as_sf() %>%
ggplot() +
geom_sf(aes(fill = classes),
size = 0.01) +
scale_fill_viridis_d(option = "F",
#n = 8,
direction = -1,
begin = .17,
end = .97) +
facet_wrap(Year ~ .) +
# guides(fill = guide_legend(barheight = unit(3, units = "mm"),
#                              barwidth = unit(90, units = "mm"),
#                              direction = "horizontal",
#                              ticks.colour = "white",
#                              title.position = "bottom",
#                              title.hjust = 0.5)) +
theme(legend.direction="horizontal",legend.position=c(0.5, 0.01), legend.box = "vertical")+
theme_void()
landkreis_long %>%
st_as_sf() %>%
ggplot() +
geom_sf(aes(fill = classes),
size = 0.01) +
scale_fill_viridis_d(option = "F",
#n = 8,
direction = -1,
begin = .17,
end = .97) +
facet_wrap(Year ~ .) +
guides(fill = guide_legend(barheight = unit(3, units = "mm"),
barwidth = unit(90, units = "mm"),
direction = "horizontal",
ticks.colour = "white",
title.position = "bottom",
title.hjust = 0.5)) +
theme(legend.direction="horizontal",legend.position=c(0.5, ), legend.box = "vertical")+
theme_void()
landkreis_long %>%
st_as_sf() %>%
ggplot() +
geom_sf(aes(fill = classes),
size = 0.01) +
scale_fill_viridis_d(option = "F",
#n = 8,
direction = -1,
begin = .17,
end = .97) +
facet_wrap(Year ~ .) +
guides(fill = guide_legend(barheight = unit(3, units = "mm"),
barwidth = unit(90, units = "mm"),
direction = "horizontal",
ticks.colour = "white",
title.position = "bottom",
title.hjust = 0.5)) +
theme(legend.direction="horizontal",legend.position=c(0.5, ), legend.box = "vertical")+
theme_void()
landkreis_long %>%
st_as_sf() %>%
ggplot() +
geom_sf(aes(fill = classes),
size = 0.01) +
scale_fill_viridis_d(option = "F",
#n = 8,
direction = -1,
begin = .17,
end = .97) +
facet_wrap(Year ~ .) +
guides(fill = guide_legend(barheight = unit(3, units = "mm"),
barwidth = unit(90, units = "mm"),
direction = "horizontal",
ticks.colour = "white",
title.position = "bottom",
title.hjust = 0.5)) +
theme(legend.direction="horizontal",legend.position="bottom", legend.box = "vertical")+
theme_void()
landkreis_long %>%
st_as_sf() %>%
ggplot() +
geom_sf(aes(fill = classes),
size = 0.01) +
scale_fill_viridis_d(option = "F",
direction = -1,
begin = .17,
end = .97) +
facet_wrap(Year ~ .) +
guides(fill = guide_legend(barheight = unit(3, units = "mm"),
barwidth = unit(90, units = "mm"),
direction = "horizontal",
ticks.colour = "white",
title.position = "bottom",
title.hjust = 0.5)) +
theme(legend.direction="horizontal",legend.position="bottom", legend.box = "vertical") +
theme_void()
landkreis_long %>%
st_as_sf() %>%
ggplot() +
geom_sf(aes(fill = classes),
size = 0.01) +
scale_fill_viridis_d(option = "F",
direction = -1,
begin = .17,
end = .97) +
facet_wrap(Year ~ .)
landkreis_long %>%
st_as_sf() %>%
ggplot() +
geom_sf(aes(fill = classes),
size = 0.01) +
scale_fill_viridis_d(option = "F",
direction = -1,
begin = .17,
end = .97) +
facet_wrap(Year ~ .) +
guides(fill = guide_legend(barheight = unit(3, units = "mm"),
barwidth = unit(90, units = "mm"),
direction = "horizontal",
ticks.colour = "white",
title.position = "bottom",
title.hjust = 0.5))
landkreis_long %>%
st_as_sf() %>%
ggplot() +
geom_sf(aes(fill = classes),
size = 0.01) +
scale_fill_viridis_d(option = "F",
direction = -1,
begin = .17,
end = .97) +
facet_wrap(Year ~ .) +
guides(fill = guide_legend(barheight = unit(3, units = "mm"),
barwidth = unit(90, units = "mm"),
direction = "horizontal",
ticks.colour = "white",
title.position = "bottom",
title.hjust = 0.5)) +
theme(legend.direction="horizontal",legend.position="bottom", legend.box = "vertical")
landkreis_long %>%
st_as_sf() %>%
ggplot() +
geom_sf(aes(fill = classes),
size = 0.01) +
scale_fill_viridis_d(option = "F",
direction = -1,
begin = .17,
end = .97) +
facet_wrap(Year ~ .) +
guides(fill = guide_legend(barheight = unit(3, units = "mm"),
barwidth = unit(90, units = "mm"),
direction = "horizontal",
ticks.colour = "white",
title.position = "bottom",
title.hjust = 0.5)) +
theme(legend.direction="horizontal",legend.position="bottom", legend.box = "vertical") +
theme_void()
landkreis_long %>%
st_as_sf() %>%
ggplot() +
geom_sf(aes(fill = classes),
size = 0.01) +
scale_fill_viridis_d(option = "F",
direction = -1,
begin = .17,
end = .97) +
facet_wrap(Year ~ .) +
guides(fill = guide_legend(keyheight = unit(3, units = "mm"),
keywidth = unit(90, units = "mm"),
direction = "horizontal",
ticks.colour = "white",
title.position = "bottom",
title.hjust = 0.5)) +
theme(legend.direction="horizontal",legend.position="bottom", legend.box = "vertical")
